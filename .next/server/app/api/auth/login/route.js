"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},5899:(e,o,n)=>{n.r(o),n.d(o,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>d,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var r={};n.r(r),n.d(r,{POST:()=>u});var s=n(9303),t=n(8716),a=n(670),i=n(7070),c=n(5748),l=n(3330);async function u(e){console.log("API LOGIN: /api/auth/login invoked");try{await (0,c.Z)();let{emailOrUsername:o,password:n}=await e.json();if(!o||!n)return i.NextResponse.json({success:!1,message:"Email/Username and password are required."},{status:400});let r=await l.Z.findOne({$or:[{email:o.toLowerCase()},{username:o.toLowerCase()}]}).select("+password");if(!r||!await r.comparePassword(n))return i.NextResponse.json({success:!1,message:"Invalid credentials."},{status:401});let s={userId:r._id.toString(),username:r.username,name:r.name,email:r.email,createdAt:r.createdAt};return console.log("API LOGIN: Login successful for user:",r.username),i.NextResponse.json({success:!0,message:"Login successful! Setting up your session.",user:s},{status:200})}catch(e){return console.error("API LOGIN Error:",e.message,e.stack),i.NextResponse.json({success:!1,message:"An unexpected server error occurred during login."},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/home/sujal/Desktop/buzzly-minimal/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:g}=m,h="/api/auth/login/route";function w(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},5748:(e,o,n)=>{n.d(o,{Z:()=>i});var r=n(1185),s=n.n(r);let t=process.env.MONGODB_URI;if(!t)throw Error("CRITICAL: MONGODB_URI is not defined. Check .env.local or environment config.");let a=global.__buzzly_minimal_mongoose_cache;a||(a=global.__buzzly_minimal_mongoose_cache={conn:null,promise:null});let i=async function(){if(a.conn){if(1===a.conn.readyState)return a.conn;console.warn(`DB: Cached connection readyState is ${a.conn.readyState}. Re-attempting.`),a.conn=null,a.promise=null}a.promise||(console.log("DB: Creating new database connection promise."),a.promise=s().connect(t,{bufferCommands:!1}).then(e=>{console.log("DB: Mongoose connected successfully via new promise!");let o=e.connection;return o.on("error",e=>{console.error("DB: Mongoose connection error event:",e),a.conn=null,a.promise=null}),o.on("disconnected",()=>{console.warn("DB: Mongoose connection disconnected event."),a.conn=null,a.promise=null}),o}).catch(e=>{throw console.error("DB: Initial mongoose.connect() promise rejected:",e.message),a.promise=null,e}));try{console.log("DB: Awaiting connection promise to resolve."),a.conn=await a.promise}catch(e){throw console.error("DB: Error awaiting connection promise:",e.message),a.promise=null,e}if(a.conn&&1===a.conn.readyState)console.log("DB: Connection active after promise resolution.");else throw console.error("DB: Post-promise, connection not active. State:",a.conn?.readyState),Error("DB: Failed to establish an active connection.");return a.conn}},3330:(e,o,n)=>{n.d(o,{Z:()=>c});var r=n(1185),s=n.n(r),t=n(2023),a=n.n(t);let i=new r.Schema({name:{type:String,required:[!0,"Please provide your name."],trim:!0,minlength:[2,"Name must be at least 2 characters long."],maxlength:[50,"Name cannot exceed 50 characters."]},email:{type:String,required:[!0,"Please provide an email address."],unique:!0,lowercase:!0,trim:!0,match:[/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/,"Please provide a valid email address."]},username:{type:String,required:[!0,"Please choose a username."],unique:!0,lowercase:!0,trim:!0,minlength:[3,"Username must be at least 3 characters."],maxlength:[20,"Username cannot exceed 20 characters."],match:[/^[a-zA-Z0-9_.]+$/,"Username can only contain letters, numbers, underscores, and periods."]},password:{type:String,required:[!0,"Please create a password."],minlength:[8,"Password must be at least 8 characters."],select:!1},createdAt:{type:Date,default:Date.now}});i.pre("save",async function(e){if(!this.isModified("password")||!this.password)return e();try{let o=await a().genSalt(10);this.password=await a().hash(this.password,o),e()}catch(o){return e(o)}}),i.methods.comparePassword=async function(e){return this.password?a().compare(e,this.password):(console.error("User.comparePassword: User's password was not available for comparison. Ensure it's selected."),!1)};let c=s().models.User||s().model("User",i)}};var o=require("../../../../webpack-runtime.js");o.C(e);var n=e=>o(o.s=e),r=o.X(0,[948,972,23],()=>n(5899));module.exports=r})();